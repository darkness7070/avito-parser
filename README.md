# Avito Parser

Простой парсер Авито для получения названий и цен квартир в аренду, написанный на Go с использованием Rod (браузерная автоматизация) и Redis для хранения данных.

## Особенности

- ✅ Парсинг объявлений с Авито
- ✅ Извлечение названий и цен квартир
- ✅ Сохранение в Redis с автоматическим истечением срока
- ✅ Браузерная автоматизация с помощью Rod
- ✅ Docker и Docker Compose поддержка
- ✅ Graceful shutdown
- ✅ Конфигурация через переменные окружения

## Быстрый старт

### С помощью Docker Compose (рекомендуется)

1. Клонируйте репозиторий:
```bash
git clone https://github.com/darkness7070/avito-parser.git
cd avito-parser
```

2. Скопируйте и настройте переменные окружения:
```bash
cp .env.example .env
```

3. Запустите приложение:
```bash
docker-compose up --build
```

### Локальная разработка

1. Убедитесь, что у вас установлены Go 1.21+ и Redis

2. Установите зависимости:
```bash
go mod tidy
```

3. Запустите Redis (или используйте Docker):
```bash
docker run -d -p 6379:6379 redis:7-alpine
```

4. Запустите приложение:
```bash
go run main.go
```

## Структура проекта

```
.
├── internal/
│   ├── config/          # Конфигурация приложения
│   ├── database/        # Redis клиент
│   ├── models/          # Модели данных
│   └── parser/          # Логика парсинга
├── docker-compose.yml   # Docker Compose конфигурация
├── Dockerfile          # Docker образ
├── go.mod             # Go модули
├── main.go            # Точка входа
└── README.md
```

## Конфигурация

Приложение настраивается через переменные окружения:

| Переменная | Описание | По умолчанию |
|-----------|----------|-------------|
| `REDIS_HOST` | Хост Redis | `localhost` |
| `REDIS_PORT` | Порт Redis | `6379` |
| `REDIS_PASSWORD` | Пароль Redis | `` |
| `REDIS_DB` | База данных Redis | `0` |
| `HEADLESS` | Запуск браузера без GUI | `true` |
| `TIMEOUT` | Таймаут операций (секунды) | `30` |
| `DELAY_BETWEEN_REQUESTS` | Задержка между запросами (секунды) | `2` |

## Использование

Приложение автоматически начнет парсить объявления по URL, указанному в `main.go`. По умолчанию парсит квартиры в аренду в Челябинске (Центральный район).

Данные сохраняются в Redis в JSON формате со структурой:
```json
{
  "id": "listing_...",
  "title": "1-к. кв., 45 м², 5/10 эт.",
  "price": "25 000 ₽/мес.",
  "url": "https://www.avito.ru/...",
  "created_at": "2024-01-15T10:30:00Z",
  "updated_at": "2024-01-15T10:30:00Z"
}
```

## Управление

- Для остановки приложения используйте `Ctrl+C`
- Приложение корректно завершит работу и закроет все соединения
- Данные в Redis автоматически истекают через 24 часа

## Технические детали

- **Go 1.21+**: Современная версия Go
- **Rod**: Браузерная автоматизация (основана на Chrome DevTools Protocol)
- **Redis**: Быстрое key-value хранилище
- **Docker**: Контейнеризация приложения
- **Graceful shutdown**: Корректное завершение работы

## Разработка

Для добавления новых функций:

1. Модели данных добавляйте в `internal/models/`
2. Логику парсинга - в `internal/parser/`
3. Работу с БД - в `internal/database/`
4. Конфигурацию - в `internal/config/`

## Лицензия

MIT License